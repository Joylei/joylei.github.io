<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
    <title>Lei&#x27;s Blog - alpine</title>
    <link rel="self" type="application/atom+xml" href="https://blog.dotone.top/tags/alpine/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://blog.dotone.top"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2020-09-16T00:00:00+00:00</updated>
    <id>https://blog.dotone.top/tags/alpine/atom.xml</id>
    <entry xml:lang="zh">
        <title>Unsuccessful try of mergerfs on Alpine Linux</title>
        <published>2020-09-16T00:00:00+00:00</published>
        <updated>2020-09-16T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://blog.dotone.top/blog/it/unsuccessful-try-mergerfs-on-alpine-linux/"/>
        <id>https://blog.dotone.top/blog/it/unsuccessful-try-mergerfs-on-alpine-linux/</id>
        
        <content type="html" xml:base="https://blog.dotone.top/blog/it/unsuccessful-try-mergerfs-on-alpine-linux/">&lt;p&gt;There is no pre-build packages for Alpine Linux.  So I build it by myself.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;install-fuse&quot;&gt;Install &lt;code&gt;fuse&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; apk add fuse3
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;build-install-mergerfs&quot;&gt;Build&amp;amp;install &lt;code&gt;mergerfs&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; clone https:&#x2F;&#x2F;github.com&#x2F;trapexit&#x2F;mergerfs.git
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#96b5b4;&quot;&gt;cd&lt;&#x2F;span&gt;&lt;span&gt; mergerfs
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;git&lt;&#x2F;span&gt;&lt;span&gt; checkout tags&#x2F;2.30.0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -b&lt;&#x2F;span&gt;&lt;span&gt; v2.30.0
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;make
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; make install
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;mergerfs&lt;&#x2F;code&gt; was installed to &lt;code&gt;&#x2F;usr&#x2F;local&#x2F;bin&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;load-fuse-mod-on-boot&quot;&gt;Load &lt;code&gt;fuse&lt;&#x2F;code&gt; mod on boot&lt;&#x2F;h2&gt;
&lt;p&gt;Add &lt;code&gt;fuse&lt;&#x2F;code&gt; to &lt;code&gt;&#x2F;boot&#x2F;extlinux.conf&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;conf&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-conf &quot;&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# Generated by update-extlinux 6.04_pre1-r6
&lt;&#x2F;span&gt;&lt;span&gt;DEFAULT menu.c32
&lt;&#x2F;span&gt;&lt;span&gt;PROMPT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0
&lt;&#x2F;span&gt;&lt;span&gt;MENU TITLE Alpine&#x2F;Linux Boot Menu
&lt;&#x2F;span&gt;&lt;span&gt;MENU HIDDEN
&lt;&#x2F;span&gt;&lt;span&gt;MENU AUTOBOOT Alpine will be booted automatically in &lt;&#x2F;span&gt;&lt;span style=&quot;color:#65737e;&quot;&gt;# seconds.
&lt;&#x2F;span&gt;&lt;span&gt;TIMEOUT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;10
&lt;&#x2F;span&gt;&lt;span&gt;LABEL lts
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;MENU &lt;&#x2F;span&gt;&lt;span&gt;DEFAULT
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;MENU &lt;&#x2F;span&gt;&lt;span&gt;LABEL Linux lts
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;LINUX &lt;&#x2F;span&gt;&lt;span&gt;vmlinuz-lts
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;INITRD &lt;&#x2F;span&gt;&lt;span&gt;initramfs-lts
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;APPEND &lt;&#x2F;span&gt;&lt;span&gt;root=UUID=d0f32707-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6030&lt;&#x2F;span&gt;&lt;span&gt;-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;473e&lt;&#x2F;span&gt;&lt;span&gt;-a236-823b90dd2e72  modules=sd-mod,usb-storage,ext4,xfs,fuse nomodeset quiet rootfstype=ext4
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;MENU SEPARATOR
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;mount-mergerfs-on-boot&quot;&gt;Mount &lt;code&gt;mergerfs&lt;&#x2F;code&gt; on boot&lt;&#x2F;h2&gt;
&lt;p&gt;Modify &lt;code&gt;&#x2F;etc&#x2F;fstab&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;conf&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-conf &quot;&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span&gt;UUID=d0f32707-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;6030&lt;&#x2F;span&gt;&lt;span&gt;-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;473e&lt;&#x2F;span&gt;&lt;span&gt;-a236-823b90dd2e72	&#x2F;	ext4	rw,relatime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 1
&lt;&#x2F;span&gt;&lt;span&gt;UUID=7794c691-bc03-4c26-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;898f&lt;&#x2F;span&gt;&lt;span&gt;-58231b93e780	&#x2F;boot	ext4	rw,relatime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 2
&lt;&#x2F;span&gt;&lt;span&gt;UUID=b5ebf3c5-39b0-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;41ec&lt;&#x2F;span&gt;&lt;span&gt;-ae68-7f08e99b7688	swap	swap	defaults	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 0
&lt;&#x2F;span&gt;&lt;span&gt;UUID=13534eb9-ae36-4af5-af78-f21b1ef34213       &#x2F;media&#x2F;disk1 xfs defaults &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 0
&lt;&#x2F;span&gt;&lt;span&gt;UUID=4a10fa24-aaea-42f1-&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;88ae&lt;&#x2F;span&gt;&lt;span&gt;-7d32c0bcab3d       &#x2F;media&#x2F;disk2 xfs defaults &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 0
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;media&#x2F;disk1:&#x2F;media&#x2F;disk2                       &#x2F;media&#x2F;vdisk fuse.mergerfs defaults,allow_other,noforget,use_ino,inodecalc=path-hash,minfreespace=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4G&lt;&#x2F;span&gt;&lt;span&gt;,ignorepponrename=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true&lt;&#x2F;span&gt;&lt;span&gt;,cache.files=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;off&lt;&#x2F;span&gt;&lt;span&gt;,category.search=epff,category.create=mfs,func.getattr=newest,posix_acl=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true 0 0
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;dev&#x2F;cdrom	&#x2F;media&#x2F;cdrom	iso9660	noauto,ro &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 0
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;dev&#x2F;usbdisk	&#x2F;media&#x2F;usb	vfat	noauto	&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0 0
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Mount &lt;code&gt;mergerfs&lt;&#x2F;code&gt; without reboot:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; mount &#x2F;media&#x2F;vdisk
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;setup-samba-share&quot;&gt;Setup Samba share&lt;&#x2F;h2&gt;
&lt;p&gt;Append below to &lt;code&gt;&#x2F;etc&#x2F;samba&#x2F;smb.conf&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;conf&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-conf &quot;&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[shares]
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;comment &lt;&#x2F;span&gt;&lt;span&gt;= All disks
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;path &lt;&#x2F;span&gt;&lt;span&gt;= &#x2F;media&#x2F;vdisk&#x2F;
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;no
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;writable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;no
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;browsable &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes     
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;valid &lt;&#x2F;span&gt;&lt;span&gt;users = lei
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;admin &lt;&#x2F;span&gt;&lt;span&gt;users = lei
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;follow &lt;&#x2F;span&gt;&lt;span&gt;symlinks = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;wide &lt;&#x2F;span&gt;&lt;span&gt;links = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;map &lt;&#x2F;span&gt;&lt;span&gt;archive = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;no
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;map &lt;&#x2F;span&gt;&lt;span&gt;system = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes
&lt;&#x2F;span&gt;&lt;span&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;map &lt;&#x2F;span&gt;&lt;span&gt;hidden = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;yes
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Restart &lt;code&gt;samba&lt;&#x2F;code&gt; service to make changes take effect:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; rc-service samba restart
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;problems&quot;&gt;Problems&lt;&#x2F;h2&gt;
&lt;p&gt;It&#x27;s OK to visit samba share from other computers after these setups. But there&#x27;s a problem the file system reports &lt;code&gt;no space left on device&lt;&#x2F;code&gt; when you create a file or directory under &lt;code&gt;&#x2F;media&#x2F;vdisk&#x2F;&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;I found that you can modify and save an existing file successfully.
At first, I thought it&#x27;s a problem of samba. 
Then I tried different configurations for samba, such as &lt;code&gt;create mask&lt;&#x2F;code&gt;, &lt;code&gt;directory mask&lt;&#x2F;code&gt;, &lt;code&gt;force create mode&lt;&#x2F;code&gt;, &lt;code&gt;force directory mode&lt;&#x2F;code&gt;, and &lt;code&gt;security mask&lt;&#x2F;code&gt; etc.
Also tried many combinations of &lt;code&gt;mergerfs&lt;&#x2F;code&gt; options.&lt;&#x2F;p&gt;
&lt;p&gt;I thought it might be permission issue. Then I changed the permissions of disks.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;sh&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-sh &quot;&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; chown&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -R&lt;&#x2F;span&gt;&lt;span&gt; lei &#x2F;media&#x2F;disk1&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; chown&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt; -R&lt;&#x2F;span&gt;&lt;span&gt; lei &#x2F;media&#x2F;disk2&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;span&gt; 777 &#x2F;media&#x2F;disk1&#x2F;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;span&gt; 777 &#x2F;media&#x2F;disk1&#x2F;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Tried different &lt;code&gt;mergerfs&lt;&#x2F;code&gt; versions, but no luck.&lt;&#x2F;p&gt;
&lt;p&gt;I even tried with different fs type, from &lt;code&gt;ext4&lt;&#x2F;code&gt;to &lt;code&gt;xfs&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Then I tried to create a file with &lt;code&gt;touch &#x2F;media&#x2F;vdisk&#x2F;temp.txt&lt;&#x2F;code&gt; or &lt;code&gt;mkdir &#x2F;media&#x2F;vdisk&#x2F;temp&lt;&#x2F;code&gt;, and got &lt;code&gt;no space left on device&lt;&#x2F;code&gt; error. Obviously it&#x27;s something wrong with &lt;code&gt;mergerfs&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
